<style>
  .admin-section{margin:24px 0;padding:16px;background:var(--card);border:1px solid var(--border);border-radius:8px}
  .admin-table{width:100%;border-collapse:collapse;font-size:13px}
  .admin-table th{text-align:left;padding:8px;border-bottom:2px solid var(--border)}
  .admin-table td{padding:8px;border-bottom:1px solid var(--border)}
  .admin-actions{display:flex;gap:8px;flex-wrap:wrap}
  .admin-actions form{margin:0}
  .admin-actions button{padding:4px 8px;font-size:12px}
  .danger{background:#ff4444;color:white;border-color:#ff4444}
  .danger:hover{background:#dd3333}
  .success{background:#28a745;color:white;border-color:#28a745}
  .success:hover{background:#218838}
  .warning{background:#ffc107;color:#000;border-color:#ffc107}
  .warning:hover{background:#e0a800}
  .admin-warning{background:var(--error-bg);border:1px solid var(--error-border);color:var(--error-text);padding:12px;border-radius:8px;margin-bottom:16px}
  .admin-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:16px;margin:20px 0}
  .stat-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center}
  .stat-card h3{margin:0;font-size:14px;color:var(--muted)}
  .stat-card p{margin:8px 0 0 0;font-size:24px;font-weight:bold}
  a.stat-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
  .filter-tabs{display:flex;gap:8px;margin-bottom:12px}
  .filter-tabs a{padding:6px 12px;border:1px solid var(--border);border-radius:6px;text-decoration:none}
  .filter-tabs a.active{background:var(--fg);color:white}
</style>

<h1>Admin Dashboard</h1>

<div style="display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 2px solid var(--border); padding-bottom: 10px;">
  <a href="/admin" style="color: var(--accent); font-weight: 600;">Dashboard</a>
  <a href="/admin/events" style="color: var(--muted); text-decoration: none; font-weight: 600;">Events</a>
</div>
<div class="admin-warning">
  <strong>‚ö†Ô∏è Admin Area</strong> - Actions here are permanent. Use with caution.
</div>

<section class="admin-stats">
  <div class="stat-card">
    <h3>Users</h3>
    <p><%= stats.totalUsers %></p>
  </div>
  <div class="stat-card">
    <h3>Letters</h3>
    <p><%= stats.totalLetters %></p>
  </div>
  <div class="stat-card">
    <h3>Pending</h3>
    <p><%= stats.pendingLetters %></p>
  </div>
  <div class="stat-card">
    <h3>Comments</h3>
    <p><%= stats.totalComments %></p>
  </div>
  <a href="/admin/events" class="stat-card" style="text-decoration: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; cursor: pointer; transition: transform 0.2s;">
    <h3 style="color: white;">üìä Events</h3>
    <p style="color: white; font-size: 14px;">View Analytics</p>
  </a>
</section>

<section class="admin-section">
  <h2>Recent Letters</h2>
  <div class="filter-tabs">
    <a href="/admin" class="<%= filter === 'all' ? 'active' : '' %>">All</a>
    <a href="/admin?filter=moderation" class="<%= filter === 'moderation' ? 'active' : '' %>" style="<%= filter === 'moderation' ? '' : '' %>">
      üîç Moderation Queue
    </a>
    <a href="/admin?filter=pending" class="<%= filter === 'pending' ? 'active' : '' %>">Pending</a>
    <a href="/admin?filter=published" class="<%= filter === 'published' ? 'active' : '' %>">Published</a>
  </div>
  <table class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Author</th>
        <th>Title</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% letters.forEach(letter => { %>
        <tr>
          <td><%= letter.id %></td>
          <td>
            @<%= letter.handle %>
            <% if (letter.is_slocialite) { %>
              <span style="color: var(--muted); font-size: 11px;">[Slocialite]</span>
            <% } %>
          </td>
          <td><a href="/letters/<%= letter.id %>"><%= letter.title.slice(0, 50) %></a></td>
          <td>
            <% if (letter.approval_status === 'pending') { %>
              <span style="color: #f59e0b;">‚è≥ Awaiting Review</span>
            <% } else if (letter.approval_status === 'rejected') { %>
              <span style="color: #ef4444;">‚ùå Rejected</span>
            <% } else if (letter.is_published) { %>
              <span style="color: #22c55e;">‚úì Published</span>
            <% } else { %>
              <span>Pending</span>
            <% } %>
          </td>
          <td><%= new Date(letter.created_at).toLocaleDateString() %></td>
          <td class="admin-actions">
            <% if (letter.approval_status === 'pending') { %>
              <form action="/admin/approve/<%= letter.id %>" method="post" style="display: inline;">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <button class="success">‚úì Approve</button>
              </form>
              <form action="/admin/reject/<%= letter.id %>" method="post" style="display: inline;">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <button class="danger">‚úó Reject</button>
              </form>
            <% } else if (!letter.is_published) { %>
              <form action="/admin/publish-now/<%= letter.id %>" method="post">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <button class="success">Publish Now</button>
              </form>
            <% } else { %>
              <form action="/admin/unpublish/<%= letter.id %>" method="post">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <button class="warning">Unpublish</button>
              </form>
            <% } %>
            <form action="/admin/delete-letter/<%= letter.id %>" method="post" onsubmit="return confirm('Delete this letter and all its comments?')">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
              <button class="danger">Delete</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</section>

<section class="admin-section">
  <h2>Recent Comments</h2>
  <table class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Author</th>
        <th>Letter</th>
        <th>Comment</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% comments.forEach(comment => { %>
        <tr>
          <td><%= comment.id %></td>
          <td>@<%= comment.handle %></td>
          <td><a href="/letters/<%= comment.letter_id %>"><%= comment.title.slice(0, 30) %></a></td>
          <td><%= comment.body.slice(0, 50) %>...</td>
          <td><%= new Date(comment.created_at).toLocaleDateString() %></td>
          <td class="admin-actions">
            <form action="/admin/delete-comment/<%= comment.id %>" method="post" onsubmit="return confirm('Delete this comment?')">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
              <button class="danger">Delete</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</section>

<section class="admin-section">
  <h2>Users</h2>
  <table class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Handle</th>
        <th>Email</th>
        <th>Admin</th>
        <th>Joined</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% users.forEach(u => { %>
        <tr>
          <td><%= u.id %></td>
          <td>
            @<%= u.handle %>
            <% if (u.is_slocialite) { %>
              <span style="color: #f59e0b; font-size: 11px;">[Slocialite]</span>
            <% } %>
          </td>
          <td><%= u.email %></td>
          <td>
            <%= u.is_admin ? '‚úì Admin' : '' %>
            <% if (!u.is_admin && !u.is_slocialite) { %>
              <span style="color: #22c55e;">Author</span>
            <% } %>
          </td>
          <td><%= new Date(u.created_at).toLocaleDateString() %></td>
          <td class="admin-actions">
            <% if (u.id !== user.id) { %>
              <% if (u.is_slocialite) { %>
                <form action="/admin/promote-to-author/<%= u.id %>" method="post" style="display: inline;">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                  <button class="success" title="Promote to Author (no moderation needed)">‚Üí Author</button>
                </form>
              <% } %>
              <form action="/admin/toggle-admin/<%= u.id %>" method="post" style="display: inline;">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <button><%= u.is_admin ? 'Remove Admin' : 'Make Admin' %></button>
              </form>
              <% if (!u.email.includes('_banned_')) { %>
                <form action="/admin/ban-user/<%= u.id %>" method="post" onsubmit="return confirm('Ban this user? They will not be able to login.')">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                  <button class="danger">Ban</button>
                </form>
              <% } else { %>
                <span style="color:red">BANNED</span>
              <% } %>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</section>
