<style>
  .author-section {
    background: linear-gradient(to bottom, #fafaf8, #f5f5f3);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin: 24px 0;
    display: flex;
    gap: 20px;
    align-items: center;
  }
  
  .author-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: white;
    border: 2px solid var(--border);
    overflow: hidden;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .author-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .author-info {
    flex: 1;
  }
  
  .author-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 4px;
  }
  
  .author-bio {
    color: var(--muted);
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 8px;
  }
  
  .author-meta {
    font-size: 13px;
    color: var(--muted);
  }
  
  .letter-header {
    border-bottom: 2px solid var(--border);
    padding-bottom: 16px;
    margin-bottom: 24px;
  }
  
  .letter-title {
    font-size: 36px;
    font-weight: 700;
    line-height: 1.2;
    margin: 0 0 12px 0;
  }
  
  .letter-date {
    color: var(--muted);
    font-size: 14px;
  }
  
  @media (max-width: 640px) {
    .author-section {
      flex-direction: column;
      text-align: center;
    }
    
    .letter-title {
      font-size: 28px;
    }
  }
</style>
 
<article class="letter-detail">
  <div class="letter-header">
    <h1 class="letter-title"><%= letter.title %></h1>
    <div class="letter-date">Published <%= new Date(letter.publish_at).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %></div>
  </div>
  
  <!-- HBR-style Author Section -->
  <div class="author-section">
    <div class="author-avatar">
      <% if (letter.avatar_url) { %>
        <img src="<%= letter.avatar_url %>" alt="<%= letter.handle %>" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\"font-size:32px\">ðŸ‘¤</span>';">
      <% } else { %>
        <span style="font-size: 32px;">ðŸ‘¤</span>
      <% } %>
    </div>
    <div class="author-info">
      <div class="author-name">@<%= letter.handle %></div>
      <% if (letter.bio) { %>
        <div class="author-bio"><%= letter.bio %></div>
      <% } %>
      <div class="author-meta">
        Drafted <%= new Date(letter.created_at).toLocaleDateString() %> Â· 
        <%= Math.ceil(letter.body.split(/\s+/).length / 200) %> min read
      </div>
    </div>
  </div>
  
  <div class="body markdown-content"><%- letter.body_html %></div>
  <div class="actions">
    <% if (user) { %>
      <% if (letter.did_resonate) { %>
        <form action="/letters/<%= letter.id %>/unresonate" method="post">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
          <button>Unresonate</button>
        </form>
      <% } else { %>
        <form action="/letters/<%= letter.id %>/resonate" method="post">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
          <button>Resonate</button>
        </form>
      <% } %>
    <% } %>
  </div>

  <section class="comments">
    <h2>Responses</h2>
    <% if (!comments.length) { %><p class="empty">No responses yet.</p><% } %>
    <ul>
      <% comments.forEach(c => { %>
        <li>
          <div class="comment-meta">@<%= c.handle %> Â· <%= new Date(c.created_at).toLocaleString() %></div>
          <div class="comment-body markdown-content"><%- c.body_html %></div>
        </li>
      <% }) %>
    </ul>

    <% if (user) { %>
      <form action="/letters/<%= letter.id %>/comment" method="post">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
        <label>Your thoughtful response <textarea name="body" rows="6" maxlength="2000" required></textarea></label>
        <button type="submit">Respond</button>
      </form>
    <% } else { %>
      <p><a href="/login">Sign in</a> to respond.</p>
    <% } %>
  </section>
</article>


